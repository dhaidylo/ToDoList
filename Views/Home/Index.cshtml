@model ToDoList.Models.Entry

@{
    ViewData["Title"] = "My TODO List";
}

<h2>My TODO List</h2>
  
<div>
    <label>Lists: </label>
    <select asp-items="@ViewBag.EntriesLists" asp-for="ListId" id="selectList"></select>
    <input id="listName" type="Text"/>
    <button id="createList">Add List</button>
</div>

<div id="entriesList"></div>

<label asp-for="Text">Text</label><br />
<input id="taskName" type="Text" asp-for="Text" />
<button id ="createTask">Add Task</button>


<script>
    function loadEntries(listId) {
        $.ajax({
            url: '/Home/GetTasks',
            type: 'GET',
            data: { listId: listId },
            success: function (data) {
                $('#entriesList').html(data);
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }
    $(document).ready(function () {
        loadEntries($('#selectList').val());

        $('#selectList').change(function () {
            var selectedValue = $(this).val();
            loadEntries(selectedValue);
        });

        $('#createTask').click(function () {
            var textInput = document.getElementById("taskName");
            var taskName = textInput.value;
            textInput.value = '';
            var listId = document.getElementById("selectList").value;

            $.ajax({
                url: '/Home/CreateTask',
                type: 'POST',
                data: { Text: taskName, ListId: listId },
                success: function (data) {
                    $('#entriesList').html(data);
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });

        $('#createList').click(function () {
            var textInput = document.getElementById('listName');
            var listName = textInput.value;
            textInput.value = '';

            $.ajax({
                url: '/Home/CreateList',
                type: 'POST',
                data: { Name: listName },
                success: function (data) {
                    var newList = $('<option>', {
                        value: data.id,
                        text: data.name
                    });

                    $('#selectList').append(newList);
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            })
        })
    });
</script>